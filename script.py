import json
import requests, bs4, csv

SAMPLE_COOKIE = 'PHPSESSID=65l23jt009ppn10vua9tv103gt; __zi=3000.SSZzejyD6z4acl6Zt1GQscQ5yUJUG0IKQ9sokCnA6uOgZwIhYLfSoo-AxU2CNrl5BSJlxuuRKyegpEBYDJ8n.1; _gid=GA1.2.1757462794.1723792516; store=505; zone=2; _ga_XHZX72VGJE=GS1.1.1723790903.1.1.1723792539.59.0.876496452; _ga=GA1.1.1165764589.1723792516'
SAMPLE_PAYLOAD = {
        'request': 'w_getProductsTaxonomy',
        'termid': 3917,
        'taxonomy': 'groups',
        'store': 505,
        'items': '93742,93291,93286,93284,93282,93280,93278,93260,93257,93254,93251,93249,93247,93245,93243,93241,93239,93237,93235,93233,93231,93229,93227,93225,93223,93221,93219,93217,93214,93212,93210,93208,93206,93204,93202,93200,93198,93193,93191,93189,93187,93185,93183,93179,93177,93175,93173,93171,93169,93167,93165,93163,93161,93159,93157,93155,93153,93151,93149,93147,93145,93143,93141,93139,93137,93134,93132,93130,93128,93126,93124,93122,93120,93117,93115,93113,93111,93109,93099,93096,93092,93089,93086,93083,92250,92248,92246,92244,92241,91516,91514,91512,91506,91504,91502,91499,91497,90167,90164,90161,90159,90157,90155,90153,90151,90147,70047,88950,88948,88946,88944,88942,88940,88938,88928,88922,88909,88907,88903,88885,87969,87967,87379,87377,87375,86488,86085,86021,85770,85648,84449,82745,82419,82042,82044,81746,81583,81581,81579,81577,81575,81571,81569,81567,81565,81563,81561,81559,81557,81555,81553,81550,81548,81546,81544,81542,81539,81537,81535,81533,81531,81529,81527,81525,81523,81519,81517,81515,81512,81510,81209,81195,81193,81187,81121,81118,81114,81110,81108,81106,81104,81098,81096,81093,81090,81088,81086,81084,81081,81078,81076,81074,81072,81069,81062,81014,80871,80868,80866,80862,80849,80840,80837,80834,80829,80770,80768,80766,80764,80762,80760,80758,80756,80754,80751,80750,80748,80746,80744,80742,80740,80738,80736,80734,80732,80730,80728,80726,80479,80419,80366,80364,80251,80222,79106,79102,79099,78539,78537,78535,78488,77054,77052,77050,77048,77044,74561,74559,74557,74555,74553,74541,74433,74431,74429,72646,72644,72642,72640,72637,72635,72607,71997,71994,71987,71983,71980,71976,71605,71603,71601,71599,71597,71595,71593,71587,71585,71583,71581,71579,71577,71575,71573,71571,71569,71567,71560,71558,71554,71552,71550,71548,71546,71544,71542,71528,71526,71523,71521,71519,71407,71405,71403,71401,71399,71397,71395,71390,70943,70589,70585,70567,70119,70107,70061,70053,70049,70045,69391,69389,68938,68936,68934,68932,68930,68928,68926,68924,68922,68920,68918,68916,68914,68911,68909,68907,68904,68902,68900,68898,68896,68894,68892,68890,68888,68886,68884,68882,68880,68878,68859,68857,68856,68854,68852,68850,68848,68845,68843,68841,68839,68830,68831,68832,68833,68828,68826,68824,68822,68820,68818,68814,68783,68778,68776,68770,68768,68764,68754,68748,68746,68743,68741,68733,68729,68723,68712,68710,68708,68706,68704,68702,68700,68698,68696,68693,68691,68679,68675,68674,68671,68670,68669,68661,68651,68645,68538,68525,68524,68514,68511,68493,68487,68479,68475,68472,68469,68454,68452,68437,68422,68374,67827,67826,66722,66576,66279,66273,66271,66269,66267,66265,66263,66261,66257,66255,66253,66251,66249,66247,66245,66243,66240,66236,66237,66137,66135,65977,65971,41076,32473,63059,63056,62492,62474,62472,61314,61312,61310,61308,61306,61304,61302,61300,61298,61296,61294,61292,61290,61288,61286,61284,61282,61280,61278,61039,61037,59680,59678,59676,59674,59672,59670,59668,59666,59664,59662,59660,59658,59656,59654,59652,59650,59648,59646,59644,59642,59640,59632,58831,58743,58741,58732,58728,58726,58026,58024,58020,58018,57277,56738,56728,56659,56467,56465,56158,54955,54953,54950,51948,51906,51902,51900,51860,51819,51815,51811,51809,51807,51805,51803,51799,51797,51795,51793,51789,51787,51785,51783,51781,51779,51777,51775,51773,51771,51769,51766,51760,51628,51626,51620,51618,50977,46859,46429,46140,46136,46132,46130,46128,46114,46108,46103,45265,45263,45261,45259,45257,45255,45253,45250,45248,45245,45240,45239,45236,45223,45225,45221,45219,45210,45201,45199,45195,45190,45191,45184,45180,45159,45157,45155,45153,45151,45149,45145,45139,45136,45132,45134,45126,45110,45092,45090,44813,44810,44711,44707,44643,43296,43294,43289,43255,43252,43248,43244,43241,43239,43237,43234,43231,43229,43227,42605,42603,42595,30862,41584,41474,41472,26661,33496,1166,27407,2580,2573,26713,40444,40255,40253,39664,39036,39034,38765,38763,38723,38721,38719,38717,38343,38341,38339,38337,38334,38332,38330,38326,38324,38322,38320,38318,38316,38313,38311,38308,38210,7070,37536,37251,37234,37232,37229,37227,273,36364,6383,35616,35614,35612,35610,35575,34743,34555,34553,34551,34549,34547,34545,34543,34541,34539,34537,34535,34260,34258,34256,34254,34140,34138,34136,34055,34052,34048,34046,34040,34029,34027,34025,34023,33995,33924,33922,33920,33918,33916,33914,33912,33910,33908,33906,33904,33902,33900,33897,33895,33893,33891,33889,33887,33885,33883,33881,33871,33869,33867,33865,33863,33861,33859,33857,33855,33853,33850,33848,33845,33843,33841,33839,33836,33834,33832,33830,33828,33826,33647,33645,33643,33641,33639,33633,33636,33634,33630,33628,33626,33624,33622,33620,33617,33615,33613,33611,33609,33607,33605,33603,33601,33599,33597,33593,33587,33577,33573,33571,33514,33512,33510,33508,33506,33504,33502,33500,33498,33491,33488,33130,33128,33126,33124,33077,33075,33073,33048,32502,32496,32494,32492,32479,32477,32475,32471,32469,32467,32465,32459,32457,32448,32446,32444,32442,32440,32438,32436,32300,32298,32292,32284,32280,32276,32274,32109,31815,31813,31812,31809,31662,31441,31440,31439,31437,31435,31434,31433,31431,31416,31414,31410,31407,31022,31014,31011,31009,31007,31004,31005,31003,31002,31000,30997,30995,30994,30991,30989,30988,30987,30986,30985,30877,30875,30858,30852,30790,30788,30787,30776,30770,30765,30761,30759,30756,30747,30741,30739,30735,30730,30728,30726,30724,30720,30716,30714,30712,30710,30708,30585,30583,30581,30579,30577,30574,30571,30569,30568,29866,29864,29862,29859,29857,29524,29522,29520,29518,29512,29452,29245,29236,29206,29204,29202,29200,29198,29196,29194,29192,29190,29188,29186,29184,29160,29158,29156,29154,29152,29150,29148,29146,29144,29142,29140,29138,29135,29131,29129,29127,29125,29123,29121,29119,29117,29115,29113,29111,29109,29107,29105,29102,29096,29094,29092,29090,29088,29085,29081,29079,29077,29075,29073,29070,29068,29045,28949,28945,28916,28909,28901,28892,28879,28872,28749,28747,28740,28715,28710,28708,28706,28577,28575,28572,28568,28565,28559,28557,28555,28552,28550,28546,28540,28502,28500,28494,28492,28485,28483,28476,27951,27949,27946,27944,27932,27872,27864,27851,27845,27831,27829,27825,27823,27813,27808,27805,27798,27795,27793,27789,27786,27784,27781,27778,27772,27765,27762,27744,27736,27727,27723,27721,27718,27716,27708,27705,27702,27699,27698,27695,27693,27688,27674,27671,27666,27649,27641,27636,27604,27582,27580,27577,27551,27549,27547,27545,27543,27541,27537,27535,27533,27531,27529,27527,27524,27519,27415,27412,27409,27402,27400,27398,1149,26725,26723,26721,26719,26717,26715,26711,26709,26707,26705,26703,26701,26673,26671,26669,26667,26649,26647,26644,1204,25827,25814,25812,25810,25808,2024,2584,25243,25235,2320,24854,24852,24850,24848,24844,24840,24838,24836,24833,2038,2240,2237,2590,23711,23709,23707,23705,23703,23695,23693,23691,23687,23685,23683,1163,22524,22516,22514,22511,22410,21884,20938,20936,1217,18104,1183,1180,17745,271,1143,266,1131,17035,17010,17008,17007,16983,2027,16878,16877,16855,16269,16260,260,16117,15777,15129,14759,14757,14753,14653,14651,14649,14538,14081,14066,13397,13395,13392,13390,13388,13378,13300,13299,13297,13295,13293,13198,13196,13194,13190,13188,13186,13184,13182,13180,13178,13176,13172,13170,13168,13166,13160,13158,13141,13140,13138,13136,13134,13120,13116,13114,13112,13108,13109,13106,13104,13102,13100,13098,13096,12749,12747,12528,12501,12497,12492,12362,12330,12313,12301,12299,12297,12295,976,11310,11305,10847,10857,10145,9820,9815,9674,9595,9593,9543,9541,9470,9466,9002,9000,8581,8578,8568,7731,7722,7717,7715,1651,2176,7221,7148,7075,7072,7066,7037,6787,499,251,248,241,238,6474,6472,6444,6442,6440,6438,6413,6403,6401,6391,6389,6387,6385,6379,6321,6319,2833,2830,2820,2717,2735,2732,2723,2615,2667,2713,2710,2670,2612,2603,2600,2597,2587,2576,2058,1599,1593,1446,1226,1223,1198,1177,1173,973,721,639,636,518,507,504,496,492,276,235',  # Continue the items list here
        'trang': 10
}
STD_HEADERS = {
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://cooponline.vn',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
        'X-Requested-With': 'XMLHttpRequest',
        'Cookie': 'PHPSESSID=be9h8diu4tduhp2shsn332v3bk; store=505; zone=2;'  # Continue with the rest of the cookies here
}


def test_request():
    url = "https://cooponline.vn/"
    headers = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Accept-Language": "en,en-US;q=0.9,vi;q=0.8"
    }
    cookies = {
        "PHPSESSID" : "65l23jt009ppn10vua9tv103gt", 
        "__zi" : "3000.SSZzejyD6z4acl6Zt1GQscQ5yUJUG0IKQ9sokCnA6uOgZwIhYLfSoo-AxU2CNrl5BSJlxuuRKyegpEBYDJ8n.1", 
        "_gid" : "GA1.2.1757462794.1723792516", 
        "_gat_gtag_UA_43670507_1" :"1", 
        "_ga_XHZX72VGJE" : "GS1.1.1723790903.1.1.1723792515.16.0.876496452", 
        "_ga" : "GA1.1.1165764589.1723792516", 
        "cf_clearance" : "oiZ5Mu1xpRyalNJL8QwjYDi_L37ySAeaG4QP_JcImqU-1723792517-1.0.1.1-9zWkCz.i_OPfQlhV2QXNNDCxsVGrEm4fus8HjR_GZoqA8g0vvYQVWAseGiMnkhtmvraNP8tczQhfu9CavgEGkQ", 
        "store" : "505",
        "zone" : "2",
    }
    response = requests.get(url, headers=headers, cookies=cookies)
    print (f'Status code: {response.status_code}')
    print (f'Cookies: {response.cookies.get_dict()}')
    # print (f'Content: {response.content}')
    
def get_cookie():
    url = "https://cooponline.vn/"
    headers = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Accept-Language": "en,en-US;q=0.9,vi;q=0.8"
    }
    response = requests.get(url, headers=headers)
    print (f'Status code: {response.status_code}')
    print (f'Cookies: {response.cookies.get_dict()}')
    
    response_ = requests.get(url, headers=headers, cookies=response.cookies)
    print (f'Status code: {response_.status_code}')
    print (f'Cookies: {response_.cookies.get_dict()}')
    
    # cookies.update({'zone': '2', 'store': '505'})
    
def get_cookie_():
    url = "https://cooponline.vn/"
    headers = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Accept-Language": "en,en-US;q=0.9,vi;q=0.8"
    }
    
    # Use a session to handle cookies across requests
    with requests.Session() as session:
        session.headers.update(headers)
        
        # First request
        response = session.get(url)
        print(f'Status code: {response.status_code}')
        print(f'Cookies after first request: {session.cookies.get_dict()}')
        
        # Second request with cookies carried over
        print (f'Cookies: {response.cookies.get_dict()}')
        response.cookies.update({'zone': '2', 'store': '505'})
        print (f'Cookies: {response.cookies.get_dict()}')
        response_ = session.get(url, cookies=response.cookies)
        print(f'Status code: {response_.status_code}')
        print(f'Cookies after second request: {session.cookies.get_dict()}')
        print (f'Cookies: {response_.cookies.get_dict()}')

def souping():
    with open('groups.html','r', encoding='utf-8') as file:
        soup = bs4.BeautifulSoup(file.read(), 'html.parser')
        data = [['GroupLink', 'GroupName']]
        for link in soup.find_all('a'):
            if 'groups' in link.get('href'):
                print(link.get('href'))
                print(link.get_text())
                data += [[link.get('href'), link.get_text()]]
    with open('groups.csv', mode='w', newline='', encoding='utf-8') as file:
        writer = csv.writer(file)
        writer.writerows(data)

def extract_data():
    readings = csv.reader(open('groups.csv', 'r', encoding='utf-8'))
    # readings = csv.DictReader(open('groups.csv', 'r', encoding='utf-8'))
    ## reader:
    # [     ['GroupLink', 'GroupName'],
    #    ['<link_1>', '<name_1>'],...   ]
    ## DictReader:
    # [{'GroupLink': '<link>', 'GroupName': '<name>'},...]
    print (list(readings))
    session = requests.Session()
    url = "https://cooponline.vn/groups/rau-cu-trai-cay/"
    # payload = {
    #     'request': 'w_getProductsTaxonomy',
    #     'termid': 3917,
    #     'taxonomy': 'groups',
    #     'store': 505,
    #     'items': '93742,93291,93286,93284,93282,93280,93278,93260,93257,93254,93251,93249,93247,93245,93243,93241,93239,93237,93235,93233,93231,93229,93227,93225,93223,93221,93219,93217,93214,93212,93210,93208,93206,93204,93202,93200,93198,93193,93191,93189,93187,93185,93183,93179,93177,93175,93173,93171,93169,93167,93165,93163,93161,93159,93157,93155,93153,93151,93149,93147,93145,93143,93141,93139,93137,93134,93132,93130,93128,93126,93124,93122,93120,93117,93115,93113,93111,93109,93099,93096,93092,93089,93086,93083,92250,92248,92246,92244,92241,91516,91514,91512,91506,91504,91502,91499,91497,90167,90164,90161,90159,90157,90155,90153,90151,90147,70047,88950,88948,88946,88944,88942,88940,88938,88928,88922,88909,88907,88903,88885,87969,87967,87379,87377,87375,86488,86085,86021,85770,85648,84449,82745,82419,82042,82044,81746,81583,81581,81579,81577,81575,81571,81569,81567,81565,81563,81561,81559,81557,81555,81553,81550,81548,81546,81544,81542,81539,81537,81535,81533,81531,81529,81527,81525,81523,81519,81517,81515,81512,81510,81209,81195,81193,81187,81121,81118,81114,81110,81108,81106,81104,81098,81096,81093,81090,81088,81086,81084,81081,81078,81076,81074,81072,81069,81062,81014,80871,80868,80866,80862,80849,80840,80837,80834,80829,80770,80768,80766,80764,80762,80760,80758,80756,80754,80751,80750,80748,80746,80744,80742,80740,80738,80736,80734,80732,80730,80728,80726,80479,80419,80366,80364,80251,80222,79106,79102,79099,78539,78537,78535,78488,77054,77052,77050,77048,77044,74561,74559,74557,74555,74553,74541,74433,74431,74429,72646,72644,72642,72640,72637,72635,72607,71997,71994,71987,71983,71980,71976,71605,71603,71601,71599,71597,71595,71593,71587,71585,71583,71581,71579,71577,71575,71573,71571,71569,71567,71560,71558,71554,71552,71550,71548,71546,71544,71542,71528,71526,71523,71521,71519,71407,71405,71403,71401,71399,71397,71395,71390,70943,70589,70585,70567,70119,70107,70061,70053,70049,70045,69391,69389,68938,68936,68934,68932,68930,68928,68926,68924,68922,68920,68918,68916,68914,68911,68909,68907,68904,68902,68900,68898,68896,68894,68892,68890,68888,68886,68884,68882,68880,68878,68859,68857,68856,68854,68852,68850,68848,68845,68843,68841,68839,68830,68831,68832,68833,68828,68826,68824,68822,68820,68818,68814,68783,68778,68776,68770,68768,68764,68754,68748,68746,68743,68741,68733,68729,68723,68712,68710,68708,68706,68704,68702,68700,68698,68696,68693,68691,68679,68675,68674,68671,68670,68669,68661,68651,68645,68538,68525,68524,68514,68511,68493,68487,68479,68475,68472,68469,68454,68452,68437,68422,68374,67827,67826,66722,66576,66279,66273,66271,66269,66267,66265,66263,66261,66257,66255,66253,66251,66249,66247,66245,66243,66240,66236,66237,66137,66135,65977,65971,41076,32473,63059,63056,62492,62474,62472,61314,61312,61310,61308,61306,61304,61302,61300,61298,61296,61294,61292,61290,61288,61286,61284,61282,61280,61278,61039,61037,59680,59678,59676,59674,59672,59670,59668,59666,59664,59662,59660,59658,59656,59654,59652,59650,59648,59646,59644,59642,59640,59632,58831,58743,58741,58732,58728,58726,58026,58024,58020,58018,57277,56738,56728,56659,56467,56465,56158,54955,54953,54950,51948,51906,51902,51900,51860,51819,51815,51811,51809,51807,51805,51803,51799,51797,51795,51793,51789,51787,51785,51783,51781,51779,51777,51775,51773,51771,51769,51766,51760,51628,51626,51620,51618,50977,46859,46429,46140,46136,46132,46130,46128,46114,46108,46103,45265,45263,45261,45259,45257,45255,45253,45250,45248,45245,45240,45239,45236,45223,45225,45221,45219,45210,45201,45199,45195,45190,45191,45184,45180,45159,45157,45155,45153,45151,45149,45145,45139,45136,45132,45134,45126,45110,45092,45090,44813,44810,44711,44707,44643,43296,43294,43289,43255,43252,43248,43244,43241,43239,43237,43234,43231,43229,43227,42605,42603,42595,30862,41584,41474,41472,26661,33496,1166,27407,2580,2573,26713,40444,40255,40253,39664,39036,39034,38765,38763,38723,38721,38719,38717,38343,38341,38339,38337,38334,38332,38330,38326,38324,38322,38320,38318,38316,38313,38311,38308,38210,7070,37536,37251,37234,37232,37229,37227,273,36364,6383,35616,35614,35612,35610,35575,34743,34555,34553,34551,34549,34547,34545,34543,34541,34539,34537,34535,34260,34258,34256,34254,34140,34138,34136,34055,34052,34048,34046,34040,34029,34027,34025,34023,33995,33924,33922,33920,33918,33916,33914,33912,33910,33908,33906,33904,33902,33900,33897,33895,33893,33891,33889,33887,33885,33883,33881,33871,33869,33867,33865,33863,33861,33859,33857,33855,33853,33850,33848,33845,33843,33841,33839,33836,33834,33832,33830,33828,33826,33647,33645,33643,33641,33639,33633,33636,33634,33630,33628,33626,33624,33622,33620,33617,33615,33613,33611,33609,33607,33605,33603,33601,33599,33597,33593,33587,33577,33573,33571,33514,33512,33510,33508,33506,33504,33502,33500,33498,33491,33488,33130,33128,33126,33124,33077,33075,33073,33048,32502,32496,32494,32492,32479,32477,32475,32471,32469,32467,32465,32459,32457,32448,32446,32444,32442,32440,32438,32436,32300,32298,32292,32284,32280,32276,32274,32109,31815,31813,31812,31809,31662,31441,31440,31439,31437,31435,31434,31433,31431,31416,31414,31410,31407,31022,31014,31011,31009,31007,31004,31005,31003,31002,31000,30997,30995,30994,30991,30989,30988,30987,30986,30985,30877,30875,30858,30852,30790,30788,30787,30776,30770,30765,30761,30759,30756,30747,30741,30739,30735,30730,30728,30726,30724,30720,30716,30714,30712,30710,30708,30585,30583,30581,30579,30577,30574,30571,30569,30568,29866,29864,29862,29859,29857,29524,29522,29520,29518,29512,29452,29245,29236,29206,29204,29202,29200,29198,29196,29194,29192,29190,29188,29186,29184,29160,29158,29156,29154,29152,29150,29148,29146,29144,29142,29140,29138,29135,29131,29129,29127,29125,29123,29121,29119,29117,29115,29113,29111,29109,29107,29105,29102,29096,29094,29092,29090,29088,29085,29081,29079,29077,29075,29073,29070,29068,29045,28949,28945,28916,28909,28901,28892,28879,28872,28749,28747,28740,28715,28710,28708,28706,28577,28575,28572,28568,28565,28559,28557,28555,28552,28550,28546,28540,28502,28500,28494,28492,28485,28483,28476,27951,27949,27946,27944,27932,27872,27864,27851,27845,27831,27829,27825,27823,27813,27808,27805,27798,27795,27793,27789,27786,27784,27781,27778,27772,27765,27762,27744,27736,27727,27723,27721,27718,27716,27708,27705,27702,27699,27698,27695,27693,27688,27674,27671,27666,27649,27641,27636,27604,27582,27580,27577,27551,27549,27547,27545,27543,27541,27537,27535,27533,27531,27529,27527,27524,27519,27415,27412,27409,27402,27400,27398,1149,26725,26723,26721,26719,26717,26715,26711,26709,26707,26705,26703,26701,26673,26671,26669,26667,26649,26647,26644,1204,25827,25814,25812,25810,25808,2024,2584,25243,25235,2320,24854,24852,24850,24848,24844,24840,24838,24836,24833,2038,2240,2237,2590,23711,23709,23707,23705,23703,23695,23693,23691,23687,23685,23683,1163,22524,22516,22514,22511,22410,21884,20938,20936,1217,18104,1183,1180,17745,271,1143,266,1131,17035,17010,17008,17007,16983,2027,16878,16877,16855,16269,16260,260,16117,15777,15129,14759,14757,14753,14653,14651,14649,14538,14081,14066,13397,13395,13392,13390,13388,13378,13300,13299,13297,13295,13293,13198,13196,13194,13190,13188,13186,13184,13182,13180,13178,13176,13172,13170,13168,13166,13160,13158,13141,13140,13138,13136,13134,13120,13116,13114,13112,13108,13109,13106,13104,13102,13100,13098,13096,12749,12747,12528,12501,12497,12492,12362,12330,12313,12301,12299,12297,12295,976,11310,11305,10847,10857,10145,9820,9815,9674,9595,9593,9543,9541,9470,9466,9002,9000,8581,8578,8568,7731,7722,7717,7715,1651,2176,7221,7148,7075,7072,7066,7037,6787,499,251,248,241,238,6474,6472,6444,6442,6440,6438,6413,6403,6401,6391,6389,6387,6385,6379,6321,6319,2833,2830,2820,2717,2735,2732,2723,2615,2667,2713,2710,2670,2612,2603,2600,2597,2587,2576,2058,1599,1593,1446,1226,1223,1198,1177,1173,973,721,639,636,518,507,504,496,492,276,235',  # Continue the items list here
    #     'trang': 10
    # }

    # Define the headers
    headers = {
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://cooponline.vn',
        'Referer': 'https://cooponline.vn/groups/rau-cu-trai-cay/',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
        'X-Requested-With': 'XMLHttpRequest',
        'Cookie': 'PHPSESSID=be9h8diu4tduhp2shsn332v3bk; store=505; zone=2;'  # Continue with the rest of the cookies here
    }
    response = session.get(url, headers=headers)
    # print (response.text)
    print ('----------------')
    print (response.status_code)
    print ('----------------')
    print (response.headers)
    print ('----------------')
    print (response.url)
    print ('----------------')
    print (response.cookies)
    print ('----------------')
    print (response.encoding)
    print ('----------------')
    soup = bs4.BeautifulSoup(response.text, 'html.parser')
    file = open('log.txt', 'w', encoding='utf-8')
    file.write(soup.prettify())
    # with open('products.csv', mode='w', newline='', encoding='utf-8') as file:
    #     writer = csv.DictWriter(file, fieldnames=['unit', 'groups', 'sku', 'post_id', 'created', 'price', 'discount', 'promotion', 'onhand', 'checked', 'maxincart', 'rules', 'onsale', 'store', 'position', 'date_begin', 'date_end', 'is_wine', 'terms', 'link', 'image', 'excerpt', 'name', 'quantity', 'noteproduct'])
    #     writer.writeheader()
    #     writer.writerows(response.json())

# use beautifulsoup to parse html
# split groups file into group links
    # data structure: dict
# go into each group link
# click as many 'further reading' button as possible
# extract product links
# go into each product link and extract products

def fetch_termids_for_groups():
    # Parse the HTML content using BeautifulSoup
    readings = list(csv.reader(open('groups.csv', 'r', encoding='utf-8')))
    session = requests.Session()
    data=[]
    for reading in readings[1:]:
        url = reading[0]
        headers = {
            'Accept': 'application/json, text/javascript, */*; q=0.01',
            'Accept-Encoding': 'gzip, deflate, br, zstd',
            'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
            'Origin': 'https://cooponline.vn',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
            'X-Requested-With': 'XMLHttpRequest',
            'Cookie': 'PHPSESSID=be9h8diu4tduhp2shsn332v3bk; store=505; zone=2;'  # Continue with the rest of the cookies here
        }
        
        response = session.get(url, headers=headers)
        soup = bs4.BeautifulSoup(response.text, 'html.parser')
        tag = soup.find(attrs={"taxonomy": "groups"})

        term_id = tag.get("term_id") if tag else None
        items = tag.get("items") if tag else None
        data.append({
            'url': url,
            'term_id': term_id,
            'items': items,
            'group_name': reading[1]
        })
        print ('Done with:', url)
    
    with open('groups.json', 'w', encoding='utf-8') as jsonfile:
        json.dump(data, jsonfile, ensure_ascii=False, indent=4)



def main():
    session = initialize_session()
    url = "https://cooponline.vn/ajax/"
    readings = json.load(open('groups.json', 'r', encoding='utf-8'))
    data=[]
    for group in readings:
        payload = {
            'request': 'w_getProductsTaxonomy',
            'termid': group['term_id'],
            'taxonomy': 'groups',
            'store': 505,
            'items': group['items'],
            'trang': 10
        }
        headers = {
            'Accept': 'application/json, text/javascript, */*; q=0.01',
            'Accept-Encoding': 'gzip, deflate, br, zstd',
            'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
            'Origin': 'https://cooponline.vn',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
            'X-Requested-With': 'XMLHttpRequest',
        }
        
        for i in range(group['max_page']):
            payload['trang'] = i
            response = session.post(url, headers=headers, data=payload)
            records = response.json()
            with open('product.csv', 'a', encoding='utf-8') as file:
                for record in records:
                    writer = csv.writer(file)
                    writer.writerow([record['unit'],record['groups'],record['sku'],record['post_id'],record['created'],record['price'],record['discount'],record['promotion'],record['onhand'],record['checked'],record['maxincart'],record['rules'],record['onsale'],record['store'],record['position'],record['date_begin'],record['date_end'],record['is_wine'],record['terms'],record['link'],record['image'],record['excerpt'],record['name'],record['quantity'],record['noteproduct']])
            print ('Done with:', group['group_name'], 'Page:', i)

def sample_group_extract():
    session = initialize_session()
    url = "https://cooponline.vn/groups/rau-cu-trai-cay/"
    headers = {
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://cooponline.vn',
        'Referer': 'https://cooponline.vn/groups/rau-cu-trai-cay/',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
        'X-Requested-With': 'XMLHttpRequest',
    }
    response = session.get(url, headers=headers)
    with open('log.txt', 'w', encoding='utf-8') as file:
        soup = bs4.BeautifulSoup(response.text, 'html.parser')
        file.write(soup.prettify())

def sample_product_extract():
    session = initialize_session()
    url = "https://cooponline.vn/ajax/"
    payload = {
        'request': 'w_getProductsTaxonomy',
        'termid': 3917,
        'taxonomy': 'groups',
        'store': 505,
        'items': '93742,93291,93286,93284,93282,93280,93278,93260,93257,93254,93251,93249,93247,93245,93243,93241,93239,93237,93235,93233,93231,93229,93227,93225,93223,93221,93219,93217,93214,93212,93210,93208,93206,93204,93202,93200,93198,93193,93191,93189,93187,93185,93183,93179,93177,93175,93173,93171,93169,93167,93165,93163,93161,93159,93157,93155,93153,93151,93149,93147,93145,93143,93141,93139,93137,93134,93132,93130,93128,93126,93124,93122,93120,93117,93115,93113,93111,93109,93099,93096,93092,93089,93086,93083,92250,92248,92246,92244,92241,91516,91514,91512,91506,91504,91502,91499,91497,90167,90164,90161,90159,90157,90155,90153,90151,90147,70047,88950,88948,88946,88944,88942,88940,88938,88928,88922,88909,88907,88903,88885,87969,87967,87379,87377,87375,86488,86085,86021,85770,85648,84449,82745,82419,82042,82044,81746,81583,81581,81579,81577,81575,81571,81569,81567,81565,81563,81561,81559,81557,81555,81553,81550,81548,81546,81544,81542,81539,81537,81535,81533,81531,81529,81527,81525,81523,81519,81517,81515,81512,81510,81209,81195,81193,81187,81121,81118,81114,81110,81108,81106,81104,81098,81096,81093,81090,81088,81086,81084,81081,81078,81076,81074,81072,81069,81062,81014,80871,80868,80866,80862,80849,80840,80837,80834,80829,80770,80768,80766,80764,80762,80760,80758,80756,80754,80751,80750,80748,80746,80744,80742,80740,80738,80736,80734,80732,80730,80728,80726,80479,80419,80366,80364,80251,80222,79106,79102,79099,78539,78537,78535,78488,77054,77052,77050,77048,77044,74561,74559,74557,74555,74553,74541,74433,74431,74429,72646,72644,72642,72640,72637,72635,72607,71997,71994,71987,71983,71980,71976,71605,71603,71601,71599,71597,71595,71593,71587,71585,71583,71581,71579,71577,71575,71573,71571,71569,71567,71560,71558,71554,71552,71550,71548,71546,71544,71542,71528,71526,71523,71521,71519,71407,71405,71403,71401,71399,71397,71395,71390,70943,70589,70585,70567,70119,70107,70061,70053,70049,70045,69391,69389,68938,68936,68934,68932,68930,68928,68926,68924,68922,68920,68918,68916,68914,68911,68909,68907,68904,68902,68900,68898,68896,68894,68892,68890,68888,68886,68884,68882,68880,68878,68859,68857,68856,68854,68852,68850,68848,68845,68843,68841,68839,68830,68831,68832,68833,68828,68826,68824,68822,68820,68818,68814,68783,68778,68776,68770,68768,68764,68754,68748,68746,68743,68741,68733,68729,68723,68712,68710,68708,68706,68704,68702,68700,68698,68696,68693,68691,68679,68675,68674,68671,68670,68669,68661,68651,68645,68538,68525,68524,68514,68511,68493,68487,68479,68475,68472,68469,68454,68452,68437,68422,68374,67827,67826,66722,66576,66279,66273,66271,66269,66267,66265,66263,66261,66257,66255,66253,66251,66249,66247,66245,66243,66240,66236,66237,66137,66135,65977,65971,41076,32473,63059,63056,62492,62474,62472,61314,61312,61310,61308,61306,61304,61302,61300,61298,61296,61294,61292,61290,61288,61286,61284,61282,61280,61278,61039,61037,59680,59678,59676,59674,59672,59670,59668,59666,59664,59662,59660,59658,59656,59654,59652,59650,59648,59646,59644,59642,59640,59632,58831,58743,58741,58732,58728,58726,58026,58024,58020,58018,57277,56738,56728,56659,56467,56465,56158,54955,54953,54950,51948,51906,51902,51900,51860,51819,51815,51811,51809,51807,51805,51803,51799,51797,51795,51793,51789,51787,51785,51783,51781,51779,51777,51775,51773,51771,51769,51766,51760,51628,51626,51620,51618,50977,46859,46429,46140,46136,46132,46130,46128,46114,46108,46103,45265,45263,45261,45259,45257,45255,45253,45250,45248,45245,45240,45239,45236,45223,45225,45221,45219,45210,45201,45199,45195,45190,45191,45184,45180,45159,45157,45155,45153,45151,45149,45145,45139,45136,45132,45134,45126,45110,45092,45090,44813,44810,44711,44707,44643,43296,43294,43289,43255,43252,43248,43244,43241,43239,43237,43234,43231,43229,43227,42605,42603,42595,30862,41584,41474,41472,26661,33496,1166,27407,2580,2573,26713,40444,40255,40253,39664,39036,39034,38765,38763,38723,38721,38719,38717,38343,38341,38339,38337,38334,38332,38330,38326,38324,38322,38320,38318,38316,38313,38311,38308,38210,7070,37536,37251,37234,37232,37229,37227,273,36364,6383,35616,35614,35612,35610,35575,34743,34555,34553,34551,34549,34547,34545,34543,34541,34539,34537,34535,34260,34258,34256,34254,34140,34138,34136,34055,34052,34048,34046,34040,34029,34027,34025,34023,33995,33924,33922,33920,33918,33916,33914,33912,33910,33908,33906,33904,33902,33900,33897,33895,33893,33891,33889,33887,33885,33883,33881,33871,33869,33867,33865,33863,33861,33859,33857,33855,33853,33850,33848,33845,33843,33841,33839,33836,33834,33832,33830,33828,33826,33647,33645,33643,33641,33639,33633,33636,33634,33630,33628,33626,33624,33622,33620,33617,33615,33613,33611,33609,33607,33605,33603,33601,33599,33597,33593,33587,33577,33573,33571,33514,33512,33510,33508,33506,33504,33502,33500,33498,33491,33488,33130,33128,33126,33124,33077,33075,33073,33048,32502,32496,32494,32492,32479,32477,32475,32471,32469,32467,32465,32459,32457,32448,32446,32444,32442,32440,32438,32436,32300,32298,32292,32284,32280,32276,32274,32109,31815,31813,31812,31809,31662,31441,31440,31439,31437,31435,31434,31433,31431,31416,31414,31410,31407,31022,31014,31011,31009,31007,31004,31005,31003,31002,31000,30997,30995,30994,30991,30989,30988,30987,30986,30985,30877,30875,30858,30852,30790,30788,30787,30776,30770,30765,30761,30759,30756,30747,30741,30739,30735,30730,30728,30726,30724,30720,30716,30714,30712,30710,30708,30585,30583,30581,30579,30577,30574,30571,30569,30568,29866,29864,29862,29859,29857,29524,29522,29520,29518,29512,29452,29245,29236,29206,29204,29202,29200,29198,29196,29194,29192,29190,29188,29186,29184,29160,29158,29156,29154,29152,29150,29148,29146,29144,29142,29140,29138,29135,29131,29129,29127,29125,29123,29121,29119,29117,29115,29113,29111,29109,29107,29105,29102,29096,29094,29092,29090,29088,29085,29081,29079,29077,29075,29073,29070,29068,29045,28949,28945,28916,28909,28901,28892,28879,28872,28749,28747,28740,28715,28710,28708,28706,28577,28575,28572,28568,28565,28559,28557,28555,28552,28550,28546,28540,28502,28500,28494,28492,28485,28483,28476,27951,27949,27946,27944,27932,27872,27864,27851,27845,27831,27829,27825,27823,27813,27808,27805,27798,27795,27793,27789,27786,27784,27781,27778,27772,27765,27762,27744,27736,27727,27723,27721,27718,27716,27708,27705,27702,27699,27698,27695,27693,27688,27674,27671,27666,27649,27641,27636,27604,27582,27580,27577,27551,27549,27547,27545,27543,27541,27537,27535,27533,27531,27529,27527,27524,27519,27415,27412,27409,27402,27400,27398,1149,26725,26723,26721,26719,26717,26715,26711,26709,26707,26705,26703,26701,26673,26671,26669,26667,26649,26647,26644,1204,25827,25814,25812,25810,25808,2024,2584,25243,25235,2320,24854,24852,24850,24848,24844,24840,24838,24836,24833,2038,2240,2237,2590,23711,23709,23707,23705,23703,23695,23693,23691,23687,23685,23683,1163,22524,22516,22514,22511,22410,21884,20938,20936,1217,18104,1183,1180,17745,271,1143,266,1131,17035,17010,17008,17007,16983,2027,16878,16877,16855,16269,16260,260,16117,15777,15129,14759,14757,14753,14653,14651,14649,14538,14081,14066,13397,13395,13392,13390,13388,13378,13300,13299,13297,13295,13293,13198,13196,13194,13190,13188,13186,13184,13182,13180,13178,13176,13172,13170,13168,13166,13160,13158,13141,13140,13138,13136,13134,13120,13116,13114,13112,13108,13109,13106,13104,13102,13100,13098,13096,12749,12747,12528,12501,12497,12492,12362,12330,12313,12301,12299,12297,12295,976,11310,11305,10847,10857,10145,9820,9815,9674,9595,9593,9543,9541,9470,9466,9002,9000,8581,8578,8568,7731,7722,7717,7715,1651,2176,7221,7148,7075,7072,7066,7037,6787,499,251,248,241,238,6474,6472,6444,6442,6440,6438,6413,6403,6401,6391,6389,6387,6385,6379,6321,6319,2833,2830,2820,2717,2735,2732,2723,2615,2667,2713,2710,2670,2612,2603,2600,2597,2587,2576,2058,1599,1593,1446,1226,1223,1198,1177,1173,973,721,639,636,518,507,504,496,492,276,235',  # Continue the items list here
        'trang': 19
    }
    headers = {
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://cooponline.vn',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
        'X-Requested-With': 'XMLHttpRequest',
    }
    response = session.post(url, headers=headers, data=payload)
    with open('log.txt', 'w', encoding='utf-8') as file:
        soup = bs4.BeautifulSoup(response.text, 'html.parser')
        file.write(soup.prettify())

def initialize_session():
    session = requests.Session()
    headers = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Accept-Language": "en,en-US;q=0.9,vi;q=0.8"
    }
    session.headers.update(headers)
    session.get('https://cooponline.vn/')
    session.cookies.update({'zone': '2', 'store': '505'})
    session.get('https://cooponline.vn/')
    print (session.cookies.get_dict())
    return session

def fetch_product_data(session):
    url = "https://cooponline.vn/ajax/"
    payload = {
        'request': 'w_getProductsTaxonomy',
        'termid': 3917,
        'taxonomy': 'groups',
        'store': 505,
        'items': '93742,93291,93286,93284,93282,93280,93278,93260,93257,93254,93251,93249,93247,93245,93243,93241,93239,93237,93235,93233,93231,93229,93227,93225,93223,93221,93219,93217,93214,93212,93210,93208,93206,93204,93202,93200,93198,93193,93191,93189,93187,93185,93183,93179,93177,93175,93173,93171,93169,93167,93165,93163,93161,93159,93157,93155,93153,93151,93149,93147,93145,93143,93141,93139,93137,93134,93132,93130,93128,93126,93124,93122,93120,93117,93115,93113,93111,93109,93099,93096,93092,93089,93086,93083,92250,92248,92246,92244,92241,91516,91514,91512,91506,91504,91502,91499,91497,90167,90164,90161,90159,90157,90155,90153,90151,90147,70047,88950,88948,88946,88944,88942,88940,88938,88928,88922,88909,88907,88903,88885,87969,87967,87379,87377,87375,86488,86085,86021,85770,85648,84449,82745,82419,82042,82044,81746,81583,81581,81579,81577,81575,81571,81569,81567,81565,81563,81561,81559,81557,81555,81553,81550,81548,81546,81544,81542,81539,81537,81535,81533,81531,81529,81527,81525,81523,81519,81517,81515,81512,81510,81209,81195,81193,81187,81121,81118,81114,81110,81108,81106,81104,81098,81096,81093,81090,81088,81086,81084,81081,81078,81076,81074,81072,81069,81062,81014,80871,80868,80866,80862,80849,80840,80837,80834,80829,80770,80768,80766,80764,80762,80760,80758,80756,80754,80751,80750,80748,80746,80744,80742,80740,80738,80736,80734,80732,80730,80728,80726,80479,80419,80366,80364,80251,80222,79106,79102,79099,78539,78537,78535,78488,77054,77052,77050,77048,77044,74561,74559,74557,74555,74553,74541,74433,74431,74429,72646,72644,72642,72640,72637,72635,72607,71997,71994,71987,71983,71980,71976,71605,71603,71601,71599,71597,71595,71593,71587,71585,71583,71581,71579,71577,71575,71573,71571,71569,71567,71560,71558,71554,71552,71550,71548,71546,71544,71542,71528,71526,71523,71521,71519,71407,71405,71403,71401,71399,71397,71395,71390,70943,70589,70585,70567,70119,70107,70061,70053,70049,70045,69391,69389,68938,68936,68934,68932,68930,68928,68926,68924,68922,68920,68918,68916,68914,68911,68909,68907,68904,68902,68900,68898,68896,68894,68892,68890,68888,68886,68884,68882,68880,68878,68859,68857,68856,68854,68852,68850,68848,68845,68843,68841,68839,68830,68831,68832,68833,68828,68826,68824,68822,68820,68818,68814,68783,68778,68776,68770,68768,68764,68754,68748,68746,68743,68741,68733,68729,68723,68712,68710,68708,68706,68704,68702,68700,68698,68696,68693,68691,68679,68675,68674,68671,68670,68669,68661,68651,68645,68538,68525,68524,68514,68511,68493,68487,68479,68475,68472,68469,68454,68452,68437,68422,68374,67827,67826,66722,66576,66279,66273,66271,66269,66267,66265,66263,66261,66257,66255,66253,66251,66249,66247,66245,66243,66240,66236,66237,66137,66135,65977,65971,41076,32473,63059,63056,62492,62474,62472,61314,61312,61310,61308,61306,61304,61302,61300,61298,61296,61294,61292,61290,61288,61286,61284,61282,61280,61278,61039,61037,59680,59678,59676,59674,59672,59670,59668,59666,59664,59662,59660,59658,59656,59654,59652,59650,59648,59646,59644,59642,59640,59632,58831,58743,58741,58732,58728,58726,58026,58024,58020,58018,57277,56738,56728,56659,56467,56465,56158,54955,54953,54950,51948,51906,51902,51900,51860,51819,51815,51811,51809,51807,51805,51803,51799,51797,51795,51793,51789,51787,51785,51783,51781,51779,51777,51775,51773,51771,51769,51766,51760,51628,51626,51620,51618,50977,46859,46429,46140,46136,46132,46130,46128,46114,46108,46103,45265,45263,45261,45259,45257,45255,45253,45250,45248,45245,45240,45239,45236,45223,45225,45221,45219,45210,45201,45199,45195,45190,45191,45184,45180,45159,45157,45155,45153,45151,45149,45145,45139,45136,45132,45134,45126,45110,45092,45090,44813,44810,44711,44707,44643,43296,43294,43289,43255,43252,43248,43244,43241,43239,43237,43234,43231,43229,43227,42605,42603,42595,30862,41584,41474,41472,26661,33496,1166,27407,2580,2573,26713,40444,40255,40253,39664,39036,39034,38765,38763,38723,38721,38719,38717,38343,38341,38339,38337,38334,38332,38330,38326,38324,38322,38320,38318,38316,38313,38311,38308,38210,7070,37536,37251,37234,37232,37229,37227,273,36364,6383,35616,35614,35612,35610,35575,34743,34555,34553,34551,34549,34547,34545,34543,34541,34539,34537,34535,34260,34258,34256,34254,34140,34138,34136,34055,34052,34048,34046,34040,34029,34027,34025,34023,33995,33924,33922,33920,33918,33916,33914,33912,33910,33908,33906,33904,33902,33900,33897,33895,33893,33891,33889,33887,33885,33883,33881,33871,33869,33867,33865,33863,33861,33859,33857,33855,33853,33850,33848,33845,33843,33841,33839,33836,33834,33832,33830,33828,33826,33647,33645,33643,33641,33639,33633,33636,33634,33630,33628,33626,33624,33622,33620,33617,33615,33613,33611,33609,33607,33605,33603,33601,33599,33597,33593,33587,33577,33573,33571,33514,33512,33510,33508,33506,33504,33502,33500,33498,33491,33488,33130,33128,33126,33124,33077,33075,33073,33048,32502,32496,32494,32492,32479,32477,32475,32471,32469,32467,32465,32459,32457,32448,32446,32444,32442,32440,32438,32436,32300,32298,32292,32284,32280,32276,32274,32109,31815,31813,31812,31809,31662,31441,31440,31439,31437,31435,31434,31433,31431,31416,31414,31410,31407,31022,31014,31011,31009,31007,31004,31005,31003,31002,31000,30997,30995,30994,30991,30989,30988,30987,30986,30985,30877,30875,30858,30852,30790,30788,30787,30776,30770,30765,30761,30759,30756,30747,30741,30739,30735,30730,30728,30726,30724,30720,30716,30714,30712,30710,30708,30585,30583,30581,30579,30577,30574,30571,30569,30568,29866,29864,29862,29859,29857,29524,29522,29520,29518,29512,29452,29245,29236,29206,29204,29202,29200,29198,29196,29194,29192,29190,29188,29186,29184,29160,29158,29156,29154,29152,29150,29148,29146,29144,29142,29140,29138,29135,29131,29129,29127,29125,29123,29121,29119,29117,29115,29113,29111,29109,29107,29105,29102,29096,29094,29092,29090,29088,29085,29081,29079,29077,29075,29073,29070,29068,29045,28949,28945,28916,28909,28901,28892,28879,28872,28749,28747,28740,28715,28710,28708,28706,28577,28575,28572,28568,28565,28559,28557,28555,28552,28550,28546,28540,28502,28500,28494,28492,28485,28483,28476,27951,27949,27946,27944,27932,27872,27864,27851,27845,27831,27829,27825,27823,27813,27808,27805,27798,27795,27793,27789,27786,27784,27781,27778,27772,27765,27762,27744,27736,27727,27723,27721,27718,27716,27708,27705,27702,27699,27698,27695,27693,27688,27674,27671,27666,27649,27641,27636,27604,27582,27580,27577,27551,27549,27547,27545,27543,27541,27537,27535,27533,27531,27529,27527,27524,27519,27415,27412,27409,27402,27400,27398,1149,26725,26723,26721,26719,26717,26715,26711,26709,26707,26705,26703,26701,26673,26671,26669,26667,26649,26647,26644,1204,25827,25814,25812,25810,25808,2024,2584,25243,25235,2320,24854,24852,24850,24848,24844,24840,24838,24836,24833,2038,2240,2237,2590,23711,23709,23707,23705,23703,23695,23693,23691,23687,23685,23683,1163,22524,22516,22514,22511,22410,21884,20938,20936,1217,18104,1183,1180,17745,271,1143,266,1131,17035,17010,17008,17007,16983,2027,16878,16877,16855,16269,16260,260,16117,15777,15129,14759,14757,14753,14653,14651,14649,14538,14081,14066,13397,13395,13392,13390,13388,13378,13300,13299,13297,13295,13293,13198,13196,13194,13190,13188,13186,13184,13182,13180,13178,13176,13172,13170,13168,13166,13160,13158,13141,13140,13138,13136,13134,13120,13116,13114,13112,13108,13109,13106,13104,13102,13100,13098,13096,12749,12747,12528,12501,12497,12492,12362,12330,12313,12301,12299,12297,12295,976,11310,11305,10847,10857,10145,9820,9815,9674,9595,9593,9543,9541,9470,9466,9002,9000,8581,8578,8568,7731,7722,7717,7715,1651,2176,7221,7148,7075,7072,7066,7037,6787,499,251,248,241,238,6474,6472,6444,6442,6440,6438,6413,6403,6401,6391,6389,6387,6385,6379,6321,6319,2833,2830,2820,2717,2735,2732,2723,2615,2667,2713,2710,2670,2612,2603,2600,2597,2587,2576,2058,1599,1593,1446,1226,1223,1198,1177,1173,973,721,639,636,518,507,504,496,492,276,235',  # Continue the items list here
        'trang': 10
    }

    # Define the headers
    headers = {
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Encoding': 'gzip, deflate, br, zstd',
        'Accept-Language': 'en-US,en;q=0.9,vi-VN;q=0.8,vi;q=0.7,fr;q=0.6',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'Origin': 'https://cooponline.vn',
        'Referer': 'https://cooponline.vn/groups/rau-cu-trai-cay/',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',
        'X-Requested-With': 'XMLHttpRequest',
        'Cookie': 'PHPSESSID=be9h8diu4tduhp2shsn332v3bk; store=505; zone=2;'  # Continue with the rest of the cookies here
    }
    response = session.post(url,data=payload, headers=headers)
    # print (response.text)
    print ('----------------')
    print (response.status_code)
    print ('----------------')
    print (response.headers)
    print ('----------------')
    print (response.url)
    print ('----------------')
    print (response.cookies)
    print ('----------------')
    print (response.encoding)
    print ('----------------')
    print (response.json()[0].keys())
    print ('----------------')
    soup = bs4.BeautifulSoup(response.text, 'html.parser')
    file = open('log.txt', 'w', encoding='utf-8')
    file.write(soup.prettify())
    # with open('products.csv', mode='w', newline='', encoding='utf-8') as file:
    #     writer = csv.DictWriter(file, fieldnames=['unit', 'groups', 'sku', 'post_id', 'created', 'price', 'discount', 'promotion', 'onhand', 'checked', 'maxincart', 'rules', 'onsale', 'store', 'position', 'date_begin', 'date_end', 'is_wine', 'terms', 'link', 'image', 'excerpt', 'name', 'quantity', 'noteproduct'])
    #     writer.writeheader()
    #     writer.writerows(response.json())
    return response
    
    
    

    
    
    
if __name__ == '__main__':
    main()
    